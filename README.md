# 数据库管理工具

## 项目概述

这是一个专业的金融数据管理系统，用于自动化获取、更新和管理股票、指数和ETF数据。系统采用模块化设计，提供Web界面和API接口，支持数据的自动更新和维护。

## 系统架构

### 核心模块

1. **StockDownloader**
   - 负责数据获取和存储
   - 提供RESTful API接口
   - 支持多种运行模式

2. **Daily Update**
   - 自动化数据更新服务
   - 智能更新控制
   - 错误处理和重试机制

3. **Web服务**
   - 用户友好的Web界面
   - 实时状态监控
   - 任务管理和控制

## 主要功能

### 1. 数据更新
- 自动获取最新的股票和指数数据
- 增量更新策略，避免重复下载
- 实时状态反馈

### 2. 数据库重建
- 完整重建数据库功能
- 自动下载所有历史数据
- 数据完整性验证

### 3. 相关度分析
- 计算股票与指数的相关度
- 自动更新相关度数据
- 支持自定义分析周期

## 部署指南

### 环境要求

- Python 3.14.0+
- PostgreSQL 数据库
- Docker（可选）

### 依赖安装

```bash
pip install -r requirements.txt
```

### Docker部署

1. 构建镜像：
```bash
docker-compose build
```

2. 启动服务：
```bash
docker-compose up -d
```
数据库表将在服务启动时自动初始化。

### 传统部署

1. 配置环境变量：
```bash
cp StockDownloader/.env.example StockDownloader/.env
# 编辑.env文件，设置数据库连接信息
```

2. 启动服务：
```bash
python server.py
```
数据库表将在服务启动时自动初始化。

## 使用指南

### Web界面

访问 http://localhost:5000 进入管理界面，提供以下功能：

1. **更新数据**
   - 点击「更新数据」按钮开始更新
   - 自动获取最新交易日数据
   - 实时显示更新进度

2. **重建数据库**
   - 点击「重建数据库」按钮开始重建
   - 自动清空并重新下载所有数据
   - 显示重建进度和状态

3. **更新相关度**
   - 点击「更新指数相关度」按钮
   - 自动计算并更新相关度数据
   - 显示计算进度

### 状态监控

- 实时显示各任务状态
- 支持多任务并行处理
- 自动禁用运行中的任务按钮

## 开发指南

### 项目结构

```
db_builder/
├── StockDownloader/     # 数据下载模块
├── daily_update/        # 自动更新模块
├── docs/                # 项目文档
├── logs/                # 日志文件
├── sql2build/           # SQL脚本
├── server.py           # Web服务入口
└── docker-compose.yml  # Docker配置
```

### 模块文档

- [StockDownloader模块](docs/StockDownloader.md)
- [Daily Update模块](docs/daily_update.md)

## 日志系统

- 日志文件位置：`logs/`目录
- 按日期自动分割日志文件
- 包含详细的操作和错误记录

## 注意事项

1. 数据安全
   - 定期备份数据库
   - 谨慎使用重建功能
   - 保护API密钥和配置信息

2. 性能优化
   - 合理控制并发任务数
   - 监控系统资源使用
   - 定期清理日志文件

3. 维护建议
   - 定期检查数据完整性
   - 监控更新任务状态
   - 及时处理错误日志

## 技术支持

如遇到问题，请查看：
1. 详细的模块文档
2. 系统日志文件
3. 提交Issue到项目仓库